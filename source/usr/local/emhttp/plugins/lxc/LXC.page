Menu="Tasks:71"
Type="xmenu"
Title="LXC"
Tabs="true"
Cond="exec(\"grep -o '^SERVICE=enabled' /boot/config/plugins/lxc/plugin.cfg 2>/dev/null\")"
---
<?php
$started = $var['fsState']=='Started';
$avail_containers = shell_exec("lxc-ls");
$default_path = shell_exec("/usr/local/emhttp/plugins/lxc/include/exec.sh default_path");
?>

<script>
//Don't execute commands again if page is refreshed
    if ( window.history.replaceState ) {
        window.history.replaceState( null, null, window.location.href );
    }
</script>

<script>
//Don't execute commands again if page is refreshed
    if ( window.history.replaceState ) {
        window.history.replaceState( null, null, window.location.href );
    }
</script>



<h1 style="text-align: center;"><a href="https://forums.unraid.net/" target="_blank" rel="noopener"><span style="color: green;">LXC</span></a></h1>
<? if (isset($started ) === true && trim($started ) !== ''): ?>
<h4 style="text-align: center;">This plugin is currently in development and features will be added over time. Currently the plugin is command line only!</h4>
<hr />
<p>&nbsp;</p>
<? if (isset($avail_containers ) === true && trim($avail_containers ) !== ''): ?>


<table id="lxc_table" class="tablesorter four shift">
<thead><tr><th><a href="#" style="cursor:hand;margin-left:12px;display:inline-block;width:32px" onclick="resetSorting()" title="Reset sorting"><i class="fa fa-th-list"></i></a>_(Name)_</th><th>_(CPUs)_</th><th>_(PID)_</th><th>_(Memory)_</th><th>_(Kernel Memory)_</th><th>_(Total RX/TX)_</th><th>_(Autostart)_</th><th>_(Edit)_</th></tr></thead>


<?php
$cont = trim($avail_containers, "\n");
$data = explode("\n", $cont);
foreach($data as $item){
  $details = shell_exec("lxc-info $item");


$replaced = explode("\n", $details);
$raw_array = preg_replace('/\s\s+/', ' ', $replaced);
foreach($raw_array as $line)
{
    $tmp = explode(": ", $line);
    $container_array[$tmp[0]] = $tmp[1];
}

//Get CPUs and autostart
$CPUs = shell_exec("/usr/local/emhttp/plugins/lxc/include/exec.sh get_CPUs ".escapeshellarg($container_array['PID'])."");
$autostart = shell_exec("/usr/local/emhttp/plugins/lxc/include/exec.sh get_autostart ".escapeshellarg($default_path)." ".escapeshellarg($container_array['Name'])."");

if($autostart=="1")
{
    $autostart_button='<a class="button">Disable</a>';
}
else 
{
    $autostart_button='<a class="button">Enable</a>';
}



// Set color from status
$status=$container_array['State'];
if($status=="RUNNING")
{
    $color="color:green";
}
else if($status=="FROZEN")
{
    $color="color:orange";
}
else 
{
    $color="color:red;";
}

?> <tbody align="left"><tr><a href="#" style="cursor:hand;margin-left:12px;display:inline-block;width:32px"><th><?php echo $container_array['Name'];?><br><span style='<?php echo "$color";?>'><?php echo $container_array['State'];?></span></th><td><?php echo $CPUs;?></td><td><?php echo $container_array['PID'];?></td><td><?php echo $container_array['Memory use'];?></td><td><?php echo $container_array['KMem use'];?></td><td><?php echo $container_array[' Total bytes'];?></td><td><?php echo $autostart_button;?></td><td><a href="LXCEditContainer" name="<?php echo $container_array['Name'];?>" class="button">Edit</a></td><td></td></tr></tbody> <?php

unset($container_array);
}

?>
</table>

<a href="LXCAddContainer" class="button">Add Container</a>

<? else: ?>
<h2 style="text-align: center;">No LXC containers installed, please go to the plugin page to configure the plugin first!</h2>
<p>To install Alpine Edge container open up a Terminal and enter:<br /><code>lxc-create --name Alpine --template download -- --dist alpine --release edge --arch amd64</code></p>
<p>To install Arch current container open up a Terminal and enter:<br /><code>lxc-create --name Arch --template download -- --dist archlinux --release current --arch amd64</code></p>
<p>To install CentOS 7 container open up a Terminal and enter:<br /><code>lxc-create --name CentOS --template download -- --dist centos --release 7 --arch amd64</code></p>
<p>To install a Debian Bullseye container open up a Terminal and enter:<br /><code>lxc-create --name Debian --template download -- --dist debian --release bullseye --arch amd64</code></p>
<p>To install Fedora 36 container open up a Terminal and enter:<br /><code>lxc-create --name Fedora --template download -- --dist fedora --release 36 --arch amd64</code></p>
<p>To install Ubuntu Xenial container open up a Terminal and enter:<br /><code>lxc-create --name Ubuntu --template download -- --dist ubuntu --release xenial --arch amd64</code></p>
<p>You can get a full list of available container images <a title=" Linux Containers - Image server" href="https://uk.lxd.images.canonical.com/" target="_blank">HERE</a></p>
<? endif; ?>
<? else: ?>
<h3 style="text-align: center;">Please start the Array!</h3>
<? endif; ?>
